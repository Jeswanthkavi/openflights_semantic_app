<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OpenFlights Semantic Search</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #74ABE2 0%, #5563DE 100%);
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 40px 20px;
      overflow-x: hidden;
    }

    h1 {
      color: white;
      margin-bottom: 20px;
      font-size: 2.5em;
      animation: fadeDown 1s ease-out;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
    }

    @keyframes fadeDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .search-container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      padding: 30px;
      width: 100%;
      max-width: 700px;
      text-align: center;
      animation: slideUp 1.2s ease;
      color: white;
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    input, select, button {
      font-size: 16px;
      padding: 12px;
      border-radius: 10px;
      border: none;
      outline: none;
      margin: 8px;
      transition: 0.3s;
    }

    input, select {
      width: 200px;
      background: rgba(255,255,255,0.9);
    }

    input:focus {
      border: 2px solid #fff;
      box-shadow: 0 0 12px rgba(255,255,255,0.6);
    }

    button {
      background: linear-gradient(135deg, #5563DE, #3b47b3);
      color: white;
      font-weight: bold;
      cursor: pointer;
      padding: 12px 20px;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    button:hover {
      transform: scale(1.08);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }

    .results {
      margin-top: 30px;
      width: 100%;
      max-width: 700px;
      max-height: 500px;
      overflow-y: auto;
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      padding: 20px;
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .result-card {
      background: #f5f7ff;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      transform: translateY(20px);
      opacity: 0;
      animation: cardFade 0.6s forwards;
    }

    .result-card:hover {
      transform: translateY(-5px) scale(1.02);
      background: #e9ecff;
    }

    @keyframes cardFade {
      to { transform: translateY(0); opacity: 1; }
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }

    .spinner {
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid #fff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 600px) {
      input, select { width: 90%; }
      .results { max-height: 350px; }
    }
  </style>
</head>

<body>
  <h1>âœˆï¸ OpenFlights Semantic Search</h1>

  <div class="search-container">
    <label for="mode">ğŸ” Search Type:</label>
    <select id="mode">
      <option value="airport">Airports</option>
      <option value="route">Routes</option>
      <option value="airline">Airlines</option>
      <option value="flight">Flights</option>
      <option value="ticket">Tickets</option>
      <option value="booking">Bookings</option>
      <option value="passenger">Passengers</option>
    </select>

    <label for="limit">Top Results:</label>
    <select id="limit">
      <option value="5">5</option>
      <option value="10" selected>10</option>
      <option value="15">15</option>
    </select>

    <br><br>
    <input type="text" id="query" placeholder="Search anything related to flights..." size="40">
    <button onclick="search()">Search</button>
  </div>

  <div class="results" id="results"></div>

  <script>
    function scrollToResults() {
      setTimeout(() => {
        document.getElementById('results').scrollIntoView({ behavior: "smooth" });
      }, 300);
    }

    async function search() {
      const query = document.getElementById('query').value.trim();
      const mode = document.getElementById('mode').value;
      const limit = document.getElementById('limit').value;
      const resultsDiv = document.getElementById('results');

      if (!query) {
        alert('âœˆï¸ Please enter a search query!');
        return;
      }

      resultsDiv.innerHTML = "<div class='loading'><div class='spinner'></div></div>";

      try {
        const response = await fetch(`/search/${mode}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query, limit })
        });

        const results = await response.json();
        resultsDiv.innerHTML = "";

        // Display the search query context above results
        resultsDiv.innerHTML = `<div style='font-size:1.1em;color:#5563DE;margin-bottom:10px;'>
          <span>ğŸ” Showing results for <strong>${query}</strong></span>
        </div>`;

        if (!results.length) {
          resultsDiv.innerHTML += "<p style='font-size:1.2em;padding:20px;'>ğŸ™ˆ No results found for your search. Try a different query!</p>";
          return;
        } else {
          resultsDiv.innerHTML += `<div style='margin-bottom:8px;color:#888;'>${results.length} result${results.length===1?"":"s"} found</div>`;
        }

        results.forEach((item, index) => {
          const card = document.createElement("div");
          card.className = "result-card";
          card.style.animationDelay = (0.12 + index*0.08) + "s"; // animated stagger

          switch (mode) {
            case "airport":
              card.innerHTML = `
                <strong style="color:#3b47b3">${item.name}</strong><br>
                ğŸŒ† ${item.city}, ${item.country}<br>
                ğŸ”¢ <span style="color:#5563de;">Similarity: ${item.similarity?.toFixed(4) || "N/A"}</span>
              `;
              break;
            case "route":
              card.innerHTML = `
                <strong style="color:#3b47b3">${item.airline}</strong><br>
                ğŸ›« ${item.source_airport} â†’ ${item.dest_airport}<br>
                ğŸ”¢ <span style="color:#5563de;">Similarity: ${item.similarity?.toFixed(4) || "N/A"}</span>
              `;
              break;
            case "airline":
              card.innerHTML = `
                <strong style="color:#3b47b3">${item.name}</strong><br>
                âœˆï¸ IATA: ${item.iata || "N/A"} | Country: ${item.country}<br>
                ğŸ”¢ <span style="color:#5563de;">Similarity: ${item.similarity?.toFixed(4) || "N/A"}</span>
              `;
              break;
            case "flight":
              card.innerHTML = `
                <strong>Flight ${item.flight_number}</strong><br>
                ğŸ›« ${item.source_airport} â†’ ${item.dest_airport}<br>
                ğŸ¢ Airline: ${item.airline_name || "N/A"}<br>
                ğŸ’° <span style="color:green;font-weight:bold;">â‚¹${item.price || "N/A"}</span> | ğŸ• Status: ${item.status || "N/A"}<br>
                ğŸ”¢ <span style="color:#5563de;">Similarity: ${item.similarity?.toFixed(4) || "N/A"}</span>
              `;
              break;
            case "ticket":
              card.innerHTML = `
                <strong>ğŸ« Ticket ID: ${item.ticket_id || "N/A"}</strong><br>
                ğŸ‘¤ Passenger: ${item.passenger_name || "N/A"}<br>
                ğŸ›« ${item.source_airport} â†’ ${item.dest_airport}<br>
                ğŸ”¢ <span style="color:#5563de;">Similarity: ${item.similarity?.toFixed(4) || "N/A"}</span>
              `;
              break;
            case "booking":
              card.innerHTML = `
                <strong>ğŸ”– Booking Reference: ${item.booking_reference || "N/A"}</strong><br>
                ğŸ—“ï¸ ${item.booking_date || "N/A"}<br>
                ğŸ‘¤ Passenger: ${item.passenger_name || "N/A"}<br>
                ğŸ”¢ <span style="color:#5563de;">Similarity: ${item.similarity?.toFixed(4) || "N/A"}</span>
              `;
              break;
            case "passenger":
              card.innerHTML = `
                <strong>ğŸ‘¤ ${item.name || item.passenger_name || "N/A"}</strong><br>
                ğŸ§³ Passport: ${item.passport || "N/A"}<br>
                ğŸŒ Country: ${item.country || "N/A"}<br>
                ğŸ”¢ <span style="color:#5563de;">Similarity: ${item.similarity?.toFixed(4) || "N/A"}</span>
              `;
              break;
            default:
              card.innerHTML = `<strong>Result</strong><br>Unknown mode.`;
          }
          resultsDiv.appendChild(card);
        });

        scrollToResults();

      } catch (err) {
        resultsDiv.innerHTML = `<p style='color:red;'>An error occurred. Please try again later.</p>`;
        console.error(err);
      }
    }

    // Allow Enter key to trigger search
    document.getElementById("query").addEventListener("keypress", function (e) {
      if (e.key === "Enter") { search(); }
    });
  </script>
</body>
</html>
